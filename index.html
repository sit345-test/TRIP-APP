<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ²–ç¹©å››æ—¥è¡Œç¨‹è¦åŠƒ</title>
    <!-- è¼‰å…¥ Tailwind CSS CDNï¼Œç”¨æ–¼å¿«é€Ÿå¯¦ç¾éŸ¿æ‡‰å¼è¨­è¨ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* æ²–ç¹©ä¸»é¡Œè‰²ï¼šæµ·æ´‹è— */
        :root {
            --okinawa-blue: #0077b6; 
            --coral-pink: #f08080;
            --sky-blue: #b3e5fc; /* è¼•ç›ˆå¤©ç©ºè— */
            --sand-color: #fff9e6; /* è¼•å¾®æ²™ç˜è‰² */
        }
        body {
            font-family: 'Inter', sans-serif;
            /* èƒŒæ™¯ç¶­æŒæ²–ç¹©é¢¨æ ¼çš„è—è‰²åˆ°ç±³è‰²æ¼¸è®Š */
            background: linear-gradient(135deg, var(--sky-blue) 0%, var(--sand-color) 100%);
            background-attachment: fixed; /* è®“èƒŒæ™¯å›ºå®š */
            padding: 20px;
        }
        .itinerary-card {
            position: relative;
            min-height: 250px; 
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); 
        }
        /* å…§éƒ¨å…§å®¹å€å¡Šï¼Œç¢ºä¿æ–‡å­—å¯è®€æ€§ */
        .content-overlay {
            /* èª¿æ•´é€æ˜åº¦è‡³ 0.6ï¼Œè®“åº•å±¤åœ–ç‰‡æ›´æ¸…æ™° */
            background-color: rgba(255, 255, 255, 0.6); 
            backdrop-filter: blur(2px); 
            border: 1px solid rgba(255, 255, 255, 0.8);
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--okinawa-blue);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 md:p-10 space-y-8">
        
        <header class="text-center pb-4 border-b-2 border-okinawa-blue">
            <h1 class="text-4xl font-extrabold text-gray-800">ğŸï¸ æ²–ç¹©å››æ—¥éŠï¼šè¡Œç¨‹è¦åŠƒ (4å¤©3å¤œ)</h1>
            <p class="text-lg text-gray-500 mt-2">é»æ“Šä¸Šæ–¹çš„æ¨™ç±¤åˆ‡æ›å…§å®¹ï¼Œæ¯å€‹åˆ†é éƒ½æœ‰ä¸åŒçš„æ²–ç¹©ç¾æ™¯å“¦ï¼</p>
        </header>

        <!-- åˆ†é å°èˆªåˆ— (èª¿æ•´ç‚º4å¤©è¡Œç¨‹) -->
        <nav class="flex justify-center flex-wrap gap-2 border-b pb-4">
            <button id="tab-day1" onclick="openTab('day1')" class="tab-button px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 border border-transparent">
                Day 1
            </button>
            <button id="tab-day2" onclick="openTab('day2')" class="tab-button px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 border border-transparent">
                Day 2
            </button>
            <button id="tab-day3" onclick="openTab('day3')" class="tab-button px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 border border-transparent">
                Day 3
            </button>
            <button id="tab-day4" onclick="openTab('day4')" class="tab-button px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 border border-transparent">
                Day 4 (è¿”ç¨‹)
            </button>
            <!-- é¡å¤–çš„è³‡è¨Šåˆ†é  -->
            <button id="tab-notes" onclick="openTab('notes')" class="tab-button px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 border border-transparent">
                æ³¨æ„äº‹é …
            </button>
            <button id="tab-must_buy" onclick="openTab('must_buy')" class="tab-button px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 border border-transparent">
                å¿…è²·ç‰©å“
            </button>
            <button id="tab-must_eat" onclick="openTab('must_eat')" class="tab-button px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 border border-transparent">
                å¿…åƒé£Ÿç‰©
            </button>
        </nav>

        <!-- è¡Œç¨‹å…§å®¹å€å¡Š (åˆ†é å…§å®¹) -->
        <section class="pt-4">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">å…§å®¹è©³æƒ…</h2>

            <!-- Day 1 Content: Naha Night (åœ‹éš›é€šå¤œæ™¯) -->
            <div id="day1" class="tab-content itinerary-card p-4 rounded-xl shadow-lg" 
                 style="background: url('https://placehold.co/1200x800/2c3e50/ffffff?text=æ²–ç¹©åœ‹éš›é€šå¤œæ™¯')">
                
                <div class="content-overlay p-4 rounded-lg">
                    <h3 class="text-xl font-semibold text-okinawa-blue mb-2">ğŸ“… Day 1: æŠµé”é‚£éœ¸èˆ‡åœ‹éš›é€šå¤œæ™¯</h3>
                    <ul class="list-disc list-inside text-gray-700 ml-4 space-y-1">
                        <li>é‚£éœ¸æ©Ÿå ´ (OKA) æŠµé”èˆ‡ç§Ÿè»Š</li>
                        <li>é£¯åº— Check-in (é‚£éœ¸å¸‚å€)</li>
                        <li>åœ‹éš›é€šè³¼ç‰©èˆ‡æ•£æ­¥ (Kokusai Street)</li>
                        <li>æ™šé¤ï¼šç‰çƒæ–°éºµ é€šå ‚</li>
                    </ul>
                    <div class="mt-4 text-sm">
                        <a href="https://maps.app.goo.gl/w62R2f8E9gHwYgG76" target="_blank" class="text-blue-600 hover:underline font-medium">
                            [ğŸ—ºï¸ åœ‹éš›é€šå°èˆª]
                        </a>
                    </div>
                    <!-- å¤©æ°£æŸ¥è©¢æŒ‰éˆ• -->
                    <button onclick="fetchWeather('Naha')" class="mt-2 text-sm text-green-700 hover:text-green-900 font-medium">
                        [ğŸŒ¦ï¸ æŸ¥è©¢é‚£éœ¸å¤©æ°£]
                    </button>
                    <div id="weather-Naha" class="mt-1 text-sm italic text-gray-600"></div>

                    <!-- Gemini Feature: Itinerary Expansion -->
                    <div class="mt-4 pt-4 border-t border-gray-300">
                        <button onclick="generateItineraryExpansion(1)" class="bg-coral-pink text-white px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-red-500 transition duration-150">
                            âœ¨ ç²å–æ›´å¤š Day 1 é»å­
                        </button>
                        <div id="gemini-day1-output" class="mt-2 text-sm text-gray-800 italic space-y-2"></div>
                    </div>
                </div>
            </div>

            <!-- Day 2 Content: Northern Okinawa (ç¾éº—æµ·æ°´æ—é¤¨) -->
            <div id="day2" class="tab-content itinerary-card p-4 rounded-xl shadow-lg hidden"
                 style="background: url('https://placehold.co/1200x800/3498db/ffffff?text=ç¾éº—æµ·æ°´æ—é¤¨é¯¨é¯Š')">
                
                <div class="content-overlay p-4 rounded-lg">
                    <h3 class="text-xl font-semibold text-okinawa-blue mb-2">ğŸ“… Day 2: åŒ—éƒ¨æµ·æ´‹é¤¨èˆ‡å¤å®‡åˆ©å³¶</h3>
                    <ul class="list-disc list-inside text-gray-700 ml-4 space-y-1">
                        <li>æµ·æ´‹åšå…¬åœ’ï¼šç¾éº—æµ·æ°´æ—é¤¨ (Churaumi Aquarium)</li>
                        <li>å¤å®‡åˆ©å¤§æ©‹èˆ‡å¿ƒå½¢å²©</li>
                        <li>æ™šé¤ï¼šæœ¬éƒ¨ç”ºæµ·é®®é¤å»³æˆ–è¦è¦é£¯</li>
                    </ul>
                    <div class="mt-4 text-sm">
                        <a href="https://maps.app.goo.gl/w62R2f8E9gHwYgG76" target="_blank" class="text-blue-600 hover:underline font-medium">
                            [ğŸ—ºï¸ ç¾éº—æµ·æ°´æ—é¤¨å°èˆª]
                        </a>
                    </div>
                    <!-- å¤©æ°£æŸ¥è©¢æŒ‰éˆ• -->
                    <button onclick="fetchWeather('Motobu')" class="mt-2 text-sm text-green-700 hover:text-green-900 font-medium">
                        [ğŸŒ¦ï¸ æŸ¥è©¢æœ¬éƒ¨å¤©æ°£]
                    </button>
                    <div id="weather-Motobu" class="mt-1 text-sm italic text-gray-600"></div>
                    
                    <!-- Gemini Feature: Itinerary Expansion -->
                    <div class="mt-4 pt-4 border-t border-gray-300">
                        <button onclick="generateItineraryExpansion(2)" class="bg-coral-pink text-white px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-red-500 transition duration-150">
                            âœ¨ ç²å–æ›´å¤š Day 2 é»å­
                        </button>
                        <div id="gemini-day2-output" class="mt-2 text-sm text-gray-800 italic space-y-2"></div>
                    </div>
                </div>
            </div>

            <!-- Day 3 Content: Central/South (ç¾åœ‹æ‘æ—¥è½) - çµåˆäº†åŸ Day 3 å’Œ Day 4 çš„ç²¾è¯ -->
            <div id="day3" class="tab-content itinerary-card p-4 rounded-xl shadow-lg hidden"
                 style="background: url('https://placehold.co/1200x800/e67e22/ffffff?text=ç¾åœ‹æ‘æ—¥è½æ‘©å¤©è¼ª')">
                
                <div class="content-overlay p-4 rounded-lg">
                    <h3 class="text-xl font-semibold text-okinawa-blue mb-2">ğŸ“… Day 3: å—éƒ¨æ–‡åŒ–èˆ‡ä¸­éƒ¨æ™‚å°š</h3>
                    <ul class="list-disc list-inside text-gray-700 ml-4 space-y-1">
                        <li>ä¸Šåˆï¼šæ²–ç¹©ä¸–ç•Œæ–‡åŒ–ç‹åœ‹ (Gyokusendo Cave) - æ¢ç´¢ç‰æ³‰æ´</li>
                        <li>ä¸‹åˆï¼šçŸ¥å¿µå²¬å…¬åœ’ - æ¬£è³çµ•ç¾æµ·æ™¯</li>
                        <li>å‚æ™šï¼šç¾åœ‹æ‘ (American Village) - æ™šé¤èˆ‡æ¬£è³æ—¥è½æ‘©å¤©è¼ª</li>
                    </ul>
                    <div class="mt-4 text-sm">
                        <a href="https://maps.app.goo.gl/95D7eE8dJk7qR2r19" target="_blank" class="text-blue-600 hover:underline font-medium">
                            [ğŸ—ºï¸ ç¾åœ‹æ‘å°èˆª]
                        </a>
                    </div>
                    <!-- å¤©æ°£æŸ¥è©¢æŒ‰éˆ• (ä½¿ç”¨ç¾åœ‹æ‘é™„è¿‘åæ¨™) -->
                    <button onclick="fetchWeather('Chatan')" class="mt-2 text-sm text-green-700 hover:text-green-900 font-medium">
                        [ğŸŒ¦ï¸ æŸ¥è©¢åŒ—è°·å¤©æ°£]
                    </button>
                    <div id="weather-Chatan" class="mt-1 text-sm italic text-gray-600"></div>

                    <!-- Gemini Feature: Itinerary Expansion -->
                    <div class="mt-4 pt-4 border-t border-gray-300">
                        <button onclick="generateItineraryExpansion(3)" class="bg-coral-pink text-white px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-red-500 transition duration-150">
                            âœ¨ ç²å–æ›´å¤š Day 3 é»å­
                        </button>
                        <div id="gemini-day3-output" class="mt-2 text-sm text-gray-800 italic space-y-2"></div>
                    </div>
                </div>
            </div>
            
            <!-- Day 4 Content: Departure (è”šè—æ²™ç˜ç©ºæ‹) - æœ€å¾Œæ¡è²·èˆ‡è¿”ç¨‹ -->
            <div id="day4" class="tab-content itinerary-card p-4 rounded-xl shadow-lg hidden"
                 style="background: url('https://placehold.co/1200x800/2ecc71/ffffff?text=æ²–ç¹©è”šè—æ²™ç˜ç©ºæ‹')">

                <div class="content-overlay p-4 rounded-lg">
                    <h3 class="text-xl font-semibold text-okinawa-blue mb-2">ğŸ“… Day 4: æœ€å¾Œæ¡è²·èˆ‡è¿”ç¨‹</h3>
                    <ul class="list-disc list-inside text-gray-700 ml-4 space-y-1">
                        <li>ä¸Šåˆï¼šæ°¸æ—ºå¤¢æ¨‚åŸæ²–ç¹©ä¾†å®¢å¤¢ (AEON Mall Rycom) æˆ– Outlet</li>
                        <li>åˆé¤ï¼šç‰çƒçš„ç‰›æˆ–è¿´è½‰å£½å¸</li>
                        <li>ä¸‹åˆï¼šå‰å¾€é‚£éœ¸æ©Ÿå ´ (OKA) è¾¦ç†ç™»æ©Ÿæ‰‹çºŒ</li>
                        <li>é‚„è»Šèˆ‡è¿”ç¨‹</li>
                    </ul>
                    <div class="mt-4 text-sm">
                        <a href="https://maps.app.goo.gl/6m5H2p9K8f9T9Fh5A" target="_blank" class="text-blue-600 hover:underline font-medium">
                            [ğŸ—ºï¸ æ©Ÿå ´å°èˆª]
                        </a>
                    </div>
                    <!-- å¤©æ°£æŸ¥è©¢æŒ‰éˆ• (ä½¿ç”¨é‚£éœ¸é™„è¿‘åæ¨™) -->
                    <button onclick="fetchWeather('Naha-Final')" class="mt-2 text-sm text-green-700 hover:text-green-900 font-medium">
                        [ğŸŒ¦ï¸ æŸ¥è©¢é‚£éœ¸å¤©æ°£]
                    </button>
                    <div id="weather-Naha-Final" class="mt-1 text-sm italic text-gray-600"></div>

                    <!-- Gemini Feature: Itinerary Expansion -->
                    <div class="mt-4 pt-4 border-t border-gray-300">
                        <button onclick="generateItineraryExpansion(4)" class="bg-coral-pink text-white px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-red-500 transition duration-150">
                            âœ¨ ç²å–æ›´å¤š Day 4 é»å­
                        </button>
                        <div id="gemini-day4-output" class="mt-2 text-sm text-gray-800 italic space-y-2"></div>
                    </div>
                </div>
            </div>

            <!-- æ–°å¢ï¼šæ³¨æ„äº‹é …åˆ†é  (ä¿æŒä¸è®Š) -->
            <div id="notes" class="tab-content itinerary-card p-4 bg-gray-50 rounded-lg shadow-sm hidden">
                <h3 class="text-xl font-semibold text-okinawa-blue mb-2">ğŸ’¡ æ²–ç¹©æ—…éŠæ³¨æ„äº‹é …</h3>
                <ul class="list-disc list-inside text-gray-600 ml-4 space-y-2">
                    <li>**äº¤é€šï¼š** æ²–ç¹©ä¸»è¦ä¾è³´è‡ªé§•ã€‚è‹¥æ­ä¹˜å…¬å…±äº¤é€šï¼Œéœ€ç•™æ„å…¬è»Šç­æ¬¡è¼ƒå°‘ä¸”æ™‚é–“è¼ƒé•·ã€‚</li>
                    <li>**é˜²æ›¬ï¼š** ç„¡è«–å­£ç¯€ï¼Œç´«å¤–ç·šéƒ½éå¸¸å¼·ï¼Œå‹™å¿…æº–å‚™é«˜ä¿‚æ•¸é˜²æ›¬ä¹³ã€å¸½å­å’Œå¤ªé™½çœ¼é¡ã€‚</li>
                    <li>**æµ·é‚Šï¼š** éƒ¨åˆ†æµ·ç˜è¨­æœ‰é–‹æ”¾æ™‚é–“å’Œå®‰å…¨å€åŸŸï¼Œè«‹å‹¿åœ¨éé–‹æ”¾æ™‚é–“ä¸‹æ°´ã€‚</li>
                    <li>**é¢±é¢¨ï¼š** å¤å­£ (7-9æœˆ) æ˜¯é¢±é¢¨å­£ï¼Œè¡Œå‰å‹™å¿…é—œæ³¨å¤©æ°£é å ±ï¼Œé¢±é¢¨å¯èƒ½å°è‡´ç­æ©Ÿå–æ¶ˆæˆ–æ™¯é»é—œé–‰ã€‚</li>
                    <li>**ç¦®å„€ï¼š** æ—¥æœ¬æ™®éé‡è¦–ç¦®ç¯€ï¼Œè«‹ä¿æŒè¼•è²ç´°èªï¼Œä¸¦éµå®ˆæ™¯é»å’Œé¤å»³çš„è¦å®šã€‚</li>
                </ul>
            </div>

            <!-- æ–°å¢ï¼šå¿…è²·ç‰©å“åˆ†é  (åŠ å…¥ LLM æ¢ç´¢åŠŸèƒ½) -->
            <div id="must_buy" class="tab-content itinerary-card p-4 bg-gray-50 rounded-lg shadow-sm hidden">
                <h3 class="text-xl font-semibold text-okinawa-blue mb-2">ğŸ å¿…è²·ä¼´æ‰‹ç¦®æ¸…å–®</h3>
                <ul class="list-disc list-inside text-gray-600 ml-4 space-y-2">
                    <li>**ç‰çƒæ³¡ç››ï¼š** æ²–ç¹©ç‰¹æœ‰çš„è’¸é¤¾é…’ï¼Œé…’ç²¾æ¿ƒåº¦è¼ƒé«˜ï¼Œé©åˆé€çµ¦é•·è¼©ã€‚</li>
                    <li>**é»‘ç³–ï¼š** æ²–ç¹©ç‰¹ç”¢ï¼Œå¯Œå«ç¤¦ç‰©è³ªï¼Œæ¨è–¦è³¼è²·ç´”é»‘ç³–å¡Šæˆ–ç›¸é—œè£½å“ã€‚</li>
                    <li>**ç´…èŠ‹å¡” (Beni-imo Tart)ï¼š** ç¶“å…¸ç”œé»ï¼Œå¤–è§€ç´«è‰²ï¼Œå£æ„Ÿé¦™ç”œç¶¿å¯†ã€‚</li>
                    <li>**æµ·é¹½ (é›ªé¹½)ï¼š** å®®å¤å³¶ç‰¹ç”¢ï¼Œé¹½å‘³æº«å’Œï¼Œé©åˆæ–™ç†æˆ–è£½ä½œç”œé»ã€‚</li>
                    <li>**é¢¨ç…çˆº (Shisa)ï¼š** æ²–ç¹©çš„å®ˆè­·ç¥ï¼Œé€šå¸¸ä¸€å…¬ä¸€æ¯æˆå°æ“ºæ”¾ï¼Œå¯ä½œç‚ºç‰¹è‰²ç´€å¿µå“ã€‚</li>
                </ul>

                <!-- Gemini Feature: Grounded Detail (Must Buy) -->
                <div class="mt-4 pt-4 border-t border-gray-300">
                    <label for="must-buy-topic" class="text-sm font-medium text-gray-700 block mb-1">
                        âœ¨ å°å“ªå€‹ä¼´æ‰‹ç¦®æ„Ÿèˆˆè¶£ï¼Ÿ (ä¾‹å¦‚ï¼šç´…èŠ‹å¡”)
                    </label>
                    <div class="flex flex-wrap gap-2">
                        <input type="text" id="must-buy-topic" value="é¢¨ç…çˆº" class="p-2 border rounded-lg text-sm flex-grow min-w-[150px]" placeholder="ä¾‹å¦‚ï¼šç‰çƒæ³¡ç››">
                        <button onclick="getGroundedDetail(document.getElementById('must-buy-topic').value, 'gemini-must_buy-output')" class="bg-okinawa-blue text-white px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-blue-600 transition duration-150">
                            æ·±å…¥äº†è§£
                        </button>
                    </div>
                    <div id="gemini-must_buy-output" class="mt-2 p-3 bg-white rounded-lg border text-sm text-gray-800 space-y-2"></div>
                </div>
            </div>

            <!-- æ–°å¢ï¼šå¿…åƒé£Ÿç‰©åˆ†é  (åŠ å…¥ LLM æ¢ç´¢åŠŸèƒ½) -->
            <div id="must_eat" class="tab-content itinerary-card p-4 bg-gray-50 rounded-lg shadow-sm hidden">
                <h3 class="text-xl font-semibold text-okinawa-blue mb-2">ğŸœ å¿…åšåœ¨åœ°ç¾é£Ÿ</h3>
                <ul class="list-disc list-inside text-gray-600 ml-4 space-y-2">
                    <li>**æ²–ç¹©éºµ (Soba)ï¼š** èˆ‡æ—¥å¼è•éº¥éºµä¸åŒï¼Œéºµæ¢ä½¿ç”¨å°éº¥ç²‰è£½ä½œï¼Œæ­é…è±šéª¨æ¹¯é ­å’Œç‡‰è‚‰ã€‚</li>
                    <li>**å¡”å¯é£¯ (Taco Rice)ï¼š** ç¾è»åŸºåœ°æ–‡åŒ–å½±éŸ¿ä¸‹çš„ç”¢ç‰©ï¼Œç±³é£¯ä¸Šé‹ªæ»¿è‚‰é†¬ã€èµ·å¸ã€ç”Ÿèœç­‰ã€‚</li>
                    <li>**è‹¦ç“œç‚’è›‹ (Goya Champuru)ï¼š** æ²–ç¹©ä»£è¡¨æ€§å®¶å¸¸èœï¼Œå°‡è‹¦ç“œã€è±†è…ã€åˆé¤è‚‰å’Œè›‹ä¸€èµ·ç‚’ã€‚</li>
                    <li>**æµ·è‘¡è„ (Umibudo)ï¼š** ä¸€ç¨®æµ·è—»ï¼Œå¤–è§€åƒç¶ è‰²é­šå­é†¬ï¼Œå£æ„Ÿç¨ç‰¹ã€‚</li>
                    <li>**Aguè±¬ï¼š** æ²–ç¹©ç‰¹æœ‰çš„é»‘æ¯›è±¬ï¼Œè‚‰è³ªé®®å«©ï¼Œæ²¹è„‚ç”œç¾ã€‚</li>
                </ul>

                <!-- Gemini Feature: Grounded Detail (Must Eat) -->
                <div class="mt-4 pt-4 border-t border-gray-300">
                    <label for="must-eat-topic" class="text-sm font-medium text-gray-700 block mb-1">
                        âœ¨ å°å“ªå€‹ç¾é£Ÿæ„Ÿèˆˆè¶£ï¼Ÿ (ä¾‹å¦‚ï¼šæ²–ç¹©éºµ)
                    </label>
                    <div class="flex flex-wrap gap-2">
                        <input type="text" id="must-eat-topic" value="è‹¦ç“œç‚’è›‹" class="p-2 border rounded-lg text-sm flex-grow min-w-[150px]" placeholder="ä¾‹å¦‚ï¼šå¡”å¯é£¯">
                        <button onclick="getGroundedDetail(document.getElementById('must-eat-topic').value, 'gemini-must_eat-output')" class="bg-okinawa-blue text-white px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-blue-600 transition duration-150">
                            æ·±å…¥äº†è§£
                        </button>
                    </div>
                    <div id="gemini-must_eat-output" class="mt-2 p-3 bg-white rounded-lg border text-sm text-gray-800 space-y-2"></div>
                </div>
            </div>

        </section>
    </div>

    <!-- è…³æœ¬å€åŸŸ -->
    <script>
        // Gemini API å¯†é‘°
        const apiKey = ""; 
        
        // å¤©æ°£æŸ¥è©¢æŒ‡ç¤ºå™¨
        const loadingIndicator = '<span class="loading-spinner inline-block align-middle mr-2"></span> è¼‰å…¥ä¸­...';
        
        /**
         * è™•ç†åˆ†é åˆ‡æ›é‚è¼¯
         * @param {string} tabId - è¦é¡¯ç¤ºçš„åˆ†é  ID (ä¾‹å¦‚: 'day1')
         */
        function openTab(tabId) {
            // éš±è—æ‰€æœ‰åˆ†é å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„æ¿€æ´»æ¨£å¼
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('bg-okinawa-blue', 'text-white');
                button.classList.add('bg-gray-200', 'text-gray-700');
            });

            // é¡¯ç¤ºç›®æ¨™åˆ†é å…§å®¹
            const targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.remove('hidden');
            }

            // è¨­ç½®ç›®æ¨™æŒ‰éˆ•çš„æ¿€æ´»æ¨£å¼
            const targetButton = document.getElementById('tab-' + tabId);
            if (targetButton) {
                targetButton.classList.remove('bg-gray-200', 'text-gray-700');
                targetButton.classList.add('bg-okinawa-blue', 'text-white');
            }
        }

        /**
         * ä½¿ç”¨ Open-Meteo API æŸ¥è©¢å¤©æ°£è³‡è¨Š (ç„¡éœ€ API Key)
         * @param {string} city - åŸå¸‚è­˜åˆ¥ç¢¼
         */
        async function fetchWeather(city) {
            let weatherDivId = 'weather-' + city.replace(/-/g, '_'); // è½‰æ› ID åç¨±
            let lat, lon, city_name;
            
            // æ ¹æ“šä¸åŒçš„åŸå¸‚ ID è¨­ç½®åæ¨™å’Œé¡¯ç¤ºåç¨±
            switch(city) {
                case 'Naha': 
                case 'Naha-Final': 
                    lat = 26.2124; lon = 127.6806; city_name = 'é‚£éœ¸å¸‚'; 
                    // è¦†è“‹ weatherDivId ä»¥åŒ¹é… HTML ID
                    if (city === 'Naha') weatherDivId = 'weather-Naha'; 
                    if (city === 'Naha-Final') weatherDivId = 'weather-Naha-Final'; 
                    break;
                case 'Motobu': 
                    lat = 26.6575; lon = 127.8864; city_name = 'æœ¬éƒ¨ç”º (æ°´æ—é¤¨)'; 
                    weatherDivId = 'weather-Motobu'; 
                    break;
                case 'Chatan': 
                    lat = 26.3045; lon = 127.7588; city_name = 'åŒ—è°·ç”º (ç¾åœ‹æ‘)'; 
                    weatherDivId = 'weather-Chatan'; 
                    break;
                default: 
                    console.error('åœ°é»ç„¡æ•ˆ:', city);
                    return;
            }

            const weatherDiv = document.getElementById(weatherDivId);
            if (!weatherDiv) return; // ç¢ºä¿å…ƒç´ å­˜åœ¨
            
            // é¿å…é‡è¤‡æŸ¥è©¢
            if (weatherDiv.innerHTML.includes('Â°C') || weatherDiv.innerHTML.includes('è¼‰å…¥ä¸­')) {
                return;
            }

            weatherDiv.innerHTML = loadingIndicator;
            
            // Open-Meteo API ç¶²å€ï¼šæŸ¥è©¢æ¯æ—¥æœ€é«˜æº«å’Œé™é›¨é‡
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,precipitation_sum&timezone=Asia%2FTokyo`;

            try {
                // å¯¦ä½œ exponential backoff
                let response;
                let data;
                const maxRetries = 3;
                let delay = 1000;
                
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        response = await fetch(url);
                        if (response.ok) {
                            data = await response.json();
                            break;
                        }
                    } catch (e) {
                        // å¿½ç•¥ç¶²è·¯éŒ¯èª¤ï¼Œæº–å‚™é‡è©¦
                    }
                    if (i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    }
                }
                
                if (!data) throw new Error("API call failed after retries.");


                const today = data.daily;
                // ç²å–ä»Šå¤©çš„æ•¸æ“š (ç´¢å¼• 0)
                const maxTemp = today.temperature_2m_max[0];
                const rain = today.precipitation_sum[0];

                weatherDiv.innerHTML = `
                    <span class="text-sm font-medium text-gray-700">
                    ${city_name} ä»Šæ—¥å¤©æ°£ï¼šæœ€é«˜æº« ${maxTemp}Â°Cï¼Œé™é›¨é‡ ${rain} mmã€‚
                    </span>
                `;
            } catch (error) {
                console.error("å¤©æ°£æŸ¥è©¢å¤±æ•—:", error);
                weatherDiv.textContent = 'ç„¡æ³•æŸ¥è©¢å¤©æ°£è³‡è¨Šï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚';
            }
        }

        // --- Gemini API æ ¸å¿ƒåŠŸèƒ½ ---

        /**
         * æ ¸å¿ƒ Gemini API å‘¼å«å‡½æ•¸ï¼Œè™•ç† loading, backoff å’Œçµæœæ ¼å¼åŒ–
         * @param {object} payload - API è«‹æ±‚çš„ JSON payload
         * @param {string} targetElementId - çµæœé¡¯ç¤ºçš„ DOM å…ƒç´  ID
         */
        async function callGemini(payload, targetElementId) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const targetDiv = document.getElementById(targetElementId);
            
            // é¡¯ç¤º loading ç‹€æ…‹
            targetDiv.innerHTML = loadingIndicator + ' (æ­£åœ¨èˆ‡ Gemini æºé€š...)'; 

            let response;
            let result;
            const maxRetries = 3;
            let delay = 1000;

            // å¯¦ä½œ exponential backoff
            for (let i = 0; i < maxRetries; i++) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        result = await response.json();
                        break;
                    } else {
                        // å˜—è©¦é‡è©¦
                        console.warn(`API attempt ${i + 1} failed with status: ${response.status}`);
                    }
                } catch (e) {
                    // å˜—è©¦é‡è©¦
                    console.error(`API attempt ${i + 1} failed with error: ${e}`);
                }

                if (i < maxRetries - 1) {
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                } else {
                    targetDiv.innerHTML = '<p class="text-red-500">âŒ æœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>';
                    return;
                }
            }

            if (!result || !result.candidates || result.candidates.length === 0) {
                targetDiv.innerHTML = '<p class="text-red-500">âŒ ç²å–è³‡è¨Šå¤±æ•—ï¼Œè«‹å˜—è©¦ä¸åŒçš„æŸ¥è©¢æˆ–ä¸»é¡Œã€‚</p>';
                return;
            }

            const candidate = result.candidates[0];
            const text = candidate.content?.parts?.[0]?.text || '';
            
            // è™•ç† Grounding Sources (å¼•ç”¨ä¾†æº)
            let sourcesHtml = '';
            const groundingMetadata = candidate.groundingMetadata;
            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                const sources = groundingMetadata.groundingAttributions
                    .map(attribution => ({
                        uri: attribution.web?.uri,
                        title: attribution.web?.title,
                    }))
                    .filter(source => source.uri && source.title)
                    .slice(0, 3); // é™åˆ¶é¡¯ç¤º 3 å€‹ä¾†æº

                if (sources.length > 0) {
                    sourcesHtml = '<div class="mt-3 pt-3 border-t border-gray-200 text-xs text-gray-500">';
                    sourcesHtml += 'åƒè€ƒè³‡æ–™ï¼š<ul class="list-none p-0 ml-0 space-y-0.5">';
                    sources.forEach((s, index) => {
                        sourcesHtml += `<li>${index + 1}. <a href="${s.uri}" target="_blank" class="hover:underline">${s.title}</a></li>`;
                    });
                    sourcesHtml += '</ul></div>';
                }
            }
            
            // ç°¡å–®çš„ Markdown è½‰ HTML è½‰æ› (æ”¯æ´ç²—é«”å’Œæ¢åˆ—å¼)
            const formattedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // ç²—é«”
                .replace(/^- (.*)/gm, '<li>$1</li>') // æ¢åˆ—å¼æ¸…å–®é …ç›®
                .replace(/^(#+)\s+(.*)/gm, (match, hashes, content) => { // æ¨™é¡Œè½‰æ›ç‚ºç²—é«”
                    return `<strong class="block mt-2 mb-1 text-base">${content}</strong>`;
                });
                
            const finalHtml = `<div class="p-3 border border-blue-200 bg-blue-50 rounded-lg shadow-inner">
                ${formattedText.startsWith('<li>') ? '<ul class="list-disc list-inside ml-4 space-y-1">' + formattedText + '</ul>' : formattedText}
                ${sourcesHtml}
            </div>`;

            targetDiv.innerHTML = finalHtml;
        }

        /**
         * å‘¼å« Gemini æ“´å±•æ¯æ—¥è¡Œç¨‹
         * @param {number} dayNumber - æ¬²æ“´å±•çš„è¡Œç¨‹æ—¥ç·¨è™Ÿ (1-4)
         */
        function generateItineraryExpansion(dayNumber) {
            const itineraryData = {
                1: "Day 1: é‚£éœ¸æ©Ÿå ´æŠµé”ã€åœ‹éš›é€šè³¼ç‰©ã€ç‰çƒæ–°éºµé€šå ‚æ™šé¤ã€‚",
                2: "Day 2: ç¾éº—æµ·æ°´æ—é¤¨ã€å¤å®‡åˆ©å³¶ã€æœ¬éƒ¨ç”ºæµ·é®®é¤å»³ã€‚",
                3: "Day 3: æ²–ç¹©ä¸–ç•Œæ–‡åŒ–ç‹åœ‹ï¼ˆç‰æ³‰æ´ï¼‰ã€çŸ¥å¿µå²¬å…¬åœ’ã€ç¾åœ‹æ‘æ—¥è½èˆ‡æ™šé¤ã€‚",
                4: "Day 4: æ°¸æ—ºå¤¢æ¨‚åŸä¾†å®¢å¤¢æˆ–Outletè³¼ç‰©ã€ç‰çƒçš„ç‰›åˆé¤ã€é‚£éœ¸æ©Ÿå ´é‚„è»Šè¿”ç¨‹ã€‚"
            };

            const prompt = `æ ¹æ“šä»¥ä¸‹æ²–ç¹©è¡Œç¨‹ï¼šã€${itineraryData[dayNumber]}ã€ï¼Œè«‹æä¾›ä¸‰å€‹é¡å¤–ä¸”å¼•äººå…¥å‹çš„é¸é …æˆ–æ´»å‹•å»ºè­°ï¼Œä¾‹å¦‚æ›¿ä»£æ™šé¤åœ°é»ã€é™„è¿‘çš„ç‰¹è‰²æ™¯é»æˆ–ç¨ç‰¹çš„è³¼ç‰©é«”é©—ã€‚è«‹ä»¥ç¹é«”ä¸­æ–‡ï¼Œä½¿ç”¨æ¢åˆ—å¼å‘ˆç¾ï¼Œæ¯å€‹å»ºè­°éƒ½åŒ…å«åœ°é»åç¨±å’Œç°¡çŸ­æè¿°ã€‚`;

            const systemInstruction = `ä½ æ˜¯ä¸€ä½å°ˆæ¥­ä¸”å¯Œæœ‰å‰µæ„çš„æ²–ç¹©æ—…éŠè¦åŠƒå¸«ã€‚ä½ çš„å›ç­”å¿…é ˆæ˜¯ç°¡æ½”ã€å‹å–„çš„æ¢åˆ—å¼æ¸…å–®ï¼Œç„¡éœ€å¼•è¨€æˆ–çµèªã€‚`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] },
            };

            callGemini(payload, `gemini-day${dayNumber}-output`);
        }

        /**
         * å‘¼å« Gemini é€²è¡Œ Google Search Grounding ä»¥æä¾›ä¸»é¡Œè©³æƒ…
         * @param {string} topic - æŸ¥è©¢ä¸»é¡Œ (ç¾é£Ÿæˆ–ä¼´æ‰‹ç¦®åç¨±)
         * @param {string} targetElementId - çµæœé¡¯ç¤ºçš„ DOM å…ƒç´  ID
         */
        function getGroundedDetail(topic, targetElementId) {
            if (!topic.trim()) {
                document.getElementById(targetElementId).innerHTML = '<p class="text-red-500">è«‹è¼¸å…¥ä¸€å€‹æŸ¥è©¢ä¸»é¡Œã€‚</p>';
                return;
            }
            
            const prompt = `è«‹ç”¨ç¹é«”ä¸­æ–‡ï¼Œæä¾›é—œæ–¼æ²–ç¹©çš„ã€Œ${topic}ã€çš„ç°¡æ½”ä»‹ç´¹ï¼Œå…§å®¹åŒ…æ‹¬å…¶ç‰¹è‰²ã€æ­·å²æˆ–é£Ÿç”¨æ–¹å¼ã€‚`;
            const systemInstruction = `ä½ æ˜¯ä¸€ä½æ²–ç¹©æ–‡åŒ–å°è¦½å“¡ã€‚è«‹ç°¡æ½”æ‰¼è¦åœ°å›ç­”å•é¡Œï¼Œå…§å®¹å¿…é ˆåŸºæ–¼æœ€æ–°çš„ç¶²è·¯è³‡è¨Šã€‚`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] },
                tools: [{ "google_search": {} }] // å•Ÿç”¨ Google Search Grounding
            };

            callGemini(payload, targetElementId);
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œï¼Œè‡ªå‹•æ‰“é–‹ Day 1 åˆ†é 
        document.addEventListener('DOMContentLoaded', () => {
            openTab('day1');
        });
    </script>

</body>
</html>